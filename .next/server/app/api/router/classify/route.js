"use strict";(()=>{var e={};e.id=9617,e.ids=[9617],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},94030:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var n={};r.r(n),r.d(n,{POST:()=>l});var s=r(22060),i=r(72433),a=r(10137),o=r(16097),u=r(82175),c=r(20095),p=r(49992);async function l(e){try{if(!(0,p.h)((0,p.t)(e,"/api/router/classify"),20,6e4).ok)return o.NextResponse.json({error:"Rate limit exceeded"},{status:429});let{session_token:t,narrative:r}=await e.json();if(!t||!r)return o.NextResponse.json({error:"Missing required fields"},{status:400});let{text:n}=await (0,u._4)({model:"openai/gpt-4o-mini",prompt:`You are an expert in Singapore financial disputes and FIDReC (Financial Industry Disputes Resolution Centre) cases.

Analyze this dispute narrative and classify it:

"${function(e){if(!e)return e;let t=e;return t=(t=(t=(t=t.replace(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi,"[REDACTED_EMAIL]")).replace(/\b([STFG]\d{7}[A-Z])\b/gi,"[REDACTED_NRIC]")).replace(/\b(\+?65[- ]?)?\d{4}[- ]?\d{4}\b/g,"[REDACTED_PHONE]")).replace(/\b\d{12,16}\b/g,"[REDACTED_ACCOUNT]")}(r)}"

Provide a JSON response with:
1. category: One of ["banking_scam", "insurance_claim", "investment_loss", "unauthorized_transaction", "service_failure", "other"]
2. institution_type: One of ["bank", "insurer", "investment_firm", "other"]
3. estimated_amount: Estimated monetary value involved (number or null)
4. urgency: One of ["high", "medium", "low"]
5. key_facts: Array of 3-5 key facts extracted from the narrative
6. initial_assessment: Brief assessment of case strength (1-2 sentences)

Return ONLY valid JSON, no other text.`,maxOutputTokens:500}),s=JSON.parse(n),i=r.replace(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi,"[redacted_email]").replace(/\b\+?\d[\d\s-]{6,}\b/g,"[redacted_phone]").replace(/\b\d{12,19}\b/g,"[redacted_number]"),a=await (0,c.createClient)();return await a.from("anonymized_training_data").insert({original_case_id:null,anonymized_narrative:i,dispute_category:s.category??null,outcome_type:null,anonymization_method:"regex_v1"}),o.NextResponse.json(s)}catch(e){return console.error("[v0] Classification error:",e),o.NextResponse.json({error:"Classification failed"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/router/classify/route",pathname:"/api/router/classify",filename:"route",bundlePath:"app/api/router/classify/route"},resolvedPagePath:"/workspaces/cursor-guidebuoy-ai-sg/app/api/router/classify/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:f}=d,g="/api/router/classify/route";function _(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},49992:(e,t,r)=>{r.d(t,{h:()=>s,t:()=>i});let n=new Map;function s(e,t=20,r=6e4){let s=Date.now(),i=n.get(e);return!i||i.expiresAt<=s?(n.set(e,{count:1,expiresAt:s+r}),{ok:!0,remaining:t-1,reset:s+r}):i.count>=t?{ok:!1,remaining:0,reset:i.expiresAt}:(i.count+=1,{ok:!0,remaining:Math.max(0,t-i.count),reset:i.expiresAt})}function i(e,t){let r=e.headers.get("x-forwarded-for")||e.ip||"unknown";return`${t}:${r}`}},20095:(e,t,r)=>{r.r(t),r.d(t,{createClient:()=>i});var n=r(54778),s=r(4599);async function i(){let e=await (0,s.cookies)();return(0,n.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:n})=>e.set(t,r,n))}catch{}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[2461,9582,3364,2175],()=>r(94030));module.exports=n})();